# Warsztaty AWS - 02

## Część 1

Tworzymy grupę:
- wybierz **User Groups** 
- nadaj dowolną nazwę
- nadaj uprawnienie **AdministratorAccess**



## Tworzymy uzytkownika:
- w konsoli wyszukaj usługę IAM.
- nazwij dowolnie
- nadaj oba typy dostępu:
   - Access key - Programmatic access
   - Password - AWS Management Console access
- dodaj uzytkownika do utworzonej wcześniej grupy
- po utworzeniu uzytkownika, kliknij **Download CSV**
 - zaimportuj profil z pliku:

    ``` 
    aws configure --profile [dowolna-nazwa-profilu] private import --csv file://sciezka-do-pliku-csv.csv
    ```

## Część 1

### Uruchomienie aplikacji backendowej 

### Wersja 1 - niezarządzana

- wyszukaj usułgę **EC2**
- kliknij **Launch instances**
- nadaj dowolną nazwę 
- wybierz AMI Amazon Linux(Free Tier eligible)
- Instance type - t2.micro
- Firewall(Security groups):
   - Create security group
   - Allow SSH traffic
   - Allow HTTP traffic
- w Advanced details, w polu User Data, wklej kod:
  
    ```
    #!/bin/bash
    apt-get update
    apt-get install -y apt-transport-https ca-certificates curl software-properties-common
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
    add-apt-repository \
    "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) \
    stable"
    apt-get update
    apt-get install -y docker-ce
    usermod -aG docker ubuntu
    ```
 - kliknij Launch instance

 - zaloguj się przez SSH
    ``` 
    docker run -p 80:80 -d public.ecr.aws/e9n4z9i6/workshop:latest
    ```

- sprawdź działanie aplikacji otwierając:
    - w konsoli AWS wybierz swoją instancję EC2 i z włąściwości skopiuj: **Public IPv4 DNS**
    - sprawdź dwa adresy, doklej do powyszego adresu:
      -  `/docs` - dokumentacja Swagger
      - `/items` - endpoint aplikacji


### Wersja 2 - klaster ECS 



### Tworzymy bucket S3

Przez konsolę AWS:
- klik, klik

lub

Z terminala:

```
aws --profile [nazwa-profilu-utworzonego-wyzej] s3api create-bucket --bucket [nazwa-bucketa]--region us-east-1
```

## Tworzymy instancję CloudFront

- wyszukaj usługę CloudFront
- Origin domain - wybierz swój S3 bucket 
- Default root object  - wpisz `index.html`
- w Origin access  wybierz:
    - Origin access control settings (recommended)
    - kliknij **Create Control Setting**
    - kliknij **Copy policy**
- przejdź do S3 
- wybierz tab Permissions
- wklej skopiowane wczęsniej uprawnienia w **Bucket Policy** 

## Sprawdźmy co udało się wykonać 

### Dostęp do plików z poziomu bucketa:
- sprawdź dostęp do plików na S3, kliknij na `index.html`
- kliknij w Object URL

### Dostęp z poziomu Cloudfront
- przejdź do CloudFront
- skopiuj `Distribution domain name` i wejdź pod ten adres
 


