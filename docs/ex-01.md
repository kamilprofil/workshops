# Warsztaty AWS - 03 - ćwiczenie 1

Pobierz repo z warsztatami:

```
git clone -b 03 --single-branch 
```

## Auto Scaling Groups 


###  Launch template
Zanim stworzymy  ASG, musimy określić jakie maszyny mają być tworzone.

W tym celu wyszukujemy usługę Launch template 
tworzymy nową tak, aby mieściła się w ramach Free Tier - zgodnie z tym jak robiliśmy to na poprzednich warsztatach(jeśli ktoś nie był, chętnie podpowiem)

Pamiętaj o:
- wybraniu / utworzeniu keypair
- wybraniu obrazu Amazon Linux


### Auto Scaling Group
Tworzymy nową ASG z następującymi parametrami:
- deafult VPC
- 2 Availability Zones
- na ekranie Configure group size and scaling policiesInfo
- Load Balancing - No load balancer
- Monitoring - włącz Group Metrics
  ustaw `Maximum Capacity` na `2`

Po utworzeniu ASG,  wejdź w jej szczegóły i zobacz co się dzieje w zakładce Activity
Przejdź do usługi EC2 i sprawdź czy ASG udało się utworzyć instancję 

### Scaling policy
- przejdź do ASG, wybierz zakładkę Automatic Scaling i utwórz Simple Scaling Policy
- utwórz CloudWatch alarm:

    - wyszukaj CPUUtilization z nazwą swojej ASG
    - w Period wybierze 1 minutę
    - w Specify metric and conditions wybierz  warunek - metryka ponad 50%
    - przy Notification mozesz kliknąć `Remove`, ale jeśli chcesz utórz notification aby dostać np. e-mail 

- wróć do ekranu z tworzeniem Auto Scaling Policy
- wybierz utworzony alarm
- Wybierz akcję - dodanie jednej maszyny

### Przygotuj centrum dowodzenia

Otwórz trzy zakładki w przeglądarce:

1. Lista instancji EC2
2. ASG - otwarta na Activity
3. CloudWatch - Alarm

### Zmuś ASG do akcji 

- Zaloguj się do maszyny EC2 

    małe przypomnienie z poprzednich warsztatów:

    - wybierz maszynę i kliknij connect
    - a następnie skopiuj komendę do logowania SSH

- po zalogowaniu, zainstaluj aplikację stress -     

    ```
    sudo yum -y update
    sudo amazon-linux-extras install epel -y
    sudo yum -y install stress
    ```
- wpisz polecenie `stress`, pojawi się przykładowe polecenie jak uzyć tego narzędzia.
  Większość domyślnych wartości nie ma dla nas znaczenia. Zmień ejdynie timeout na np. `200`

  - sprawdź otwarte wyzej zakładki